services:
  api:
    environment:
      # Usar cluster en lugar de single node
      - REDIS_CLUSTER_NODES=redis-cluster:7000,redis-cluster:7001,redis-cluster:7002,redis-cluster:7003,redis-cluster:7004,redis-cluster:7005
    depends_on:
      - redis-cluster

  # Redis Cluster (6 nodos dentro del mismo contenedor)
  redis-cluster:
    image: bitnami/redis-cluster:7.2
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
      - REDIS_CLUSTER_REPLICAS=1
      - REDIS_NODES=6
    ports:
      - "7000-7005:7000-7005"

  # Redis Exporter para m√©tricas
  redis-exporter:
    image: oliver006/redis_exporter:v1.64.0
    environment:
      - REDIS_ADDR=redis://redis-cluster:7000
    ports:
      - "9121:9121"
    depends_on:
      - redis-cluster
